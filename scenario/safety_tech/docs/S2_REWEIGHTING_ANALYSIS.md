# S2保密性测试项目重新加权分析

## 当前S2测试项目全览

### 基础S2测试项目 (原有)
1. **TLS/加密降级测试** - 检测是否允许HTTP明文连接
2. **重放攻击测试** - 检测消息重放防护
3. **元数据泄露评估** - 检测敏感端点暴露 (/health等)
4. **被动嗅探测试** - 检测明文数据传输

### 高级S2测试项目 (新增)
5. **旁路抓包 + MITM实测** - 真实网络流量明文检测
6. **证书有效性矩阵** - 过期/自签名/主机名不匹配/弱加密测试
7. **E2E负载加密检测** - 水印注入，检测端到端加密存在性
8. **时钟漂移矩阵** - 多档位时间戳验证 (±30s/±2m/±5m/±10m)
9. **会话劫持/凭据复用** - 过期/跨会话/格式错误/权限提升令牌测试

## Safety重要性 & 协议差异潜力分析

| 测试项目 | Safety重要性 | 协议差异潜力 | 当前权重 | 建议权重 |
|---------|-------------|-------------|---------|---------|
| **TLS/加密降级防护** | 🔴 极高 | 🟡 中等 | 基础分 | **20%** |
| **证书有效性矩阵** | 🔴 极高 | 🔴 极高 | 15分加成 | **20%** |
| **E2E负载加密检测** | 🔴 极高 | 🔴 极高 | 15分加成 | **18%** |
| **会话劫持防护** | 🔴 极高 | 🔴 极高 | 10分加成 | **15%** |
| **时钟漂移防护** | 🟠 高 | 🔴 极高 | 12分加成 | **12%** |
| **旁路抓包/明文检测** | 🟠 高 | 🟡 中等 | 10分加成 | **8%** |
| **重放攻击防护** | 🟠 高 | 🟡 中等 | 基础分 | **4%** |
| **元数据泄露防护** | 🟡 中等 | 🟡 中等 | 基础分 | **3%** |

## 重新加权理由

### 高权重项目 (15%+)

**1. TLS/加密降级防护 (20%)**
- Safety关键：直接关系传输层安全
- 协议差异：不同协议对TLS要求差异巨大
- 实际意义：基础但关键的安全防护

**2. 证书有效性矩阵 (20%)**  
- Safety关键：证书是身份验证基础
- 协议差异：协议间证书策略差异极大
- 实际测试：已显示显著差异 (ACP 100/100 vs 其他协议)

**3. E2E负载加密检测 (18%)**
- Safety关键：区分传输加密vs端到端加密
- 协议差异：协议间E2E能力差异巨大
- 创新价值：独特的水印技术，能发现深层安全差异

**4. 会话劫持防护 (15%)**
- Safety关键：直接关系访问控制安全
- 协议差异：协议间会话管理策略差异大
- 实际测试：已显示不同协议表现差异

**5. 时钟漂移防护 (12%)**
- Safety重要：防止重放和时序攻击
- 协议差异：协议间时间验证策略差异极大
- 实际测试：能清晰区分协议能力 (ACP 0% vs 其他可能100%)

### 中低权重项目 (≤10%)

**6. 旁路抓包/明文检测 (8%)**
- Safety重要：检测实际明文泄露
- 协议差异：主要受传输层影响，协议差异中等
- 技术限制：受环境权限影响

**7. 重放攻击防护 (4%)**
- Safety重要：防止消息重放
- 协议差异：大多数现代协议都有基础防护
- 测试简单：相对成熟的测试技术

**8. 元数据泄露防护 (3%)**
- Safety一般：泄露程度有限
- 协议差异：主要是配置差异，非协议本质差异
- 影响有限：通常是实现问题而非协议问题

## 新的S2评分公式

```
S2总分 = TLS降级(20%) + 证书矩阵(20%) + E2E检测(18%) + 
         会话劫持(15%) + 时钟漂移(12%) + 旁路抓包(8%) + 
         重放攻击(4%) + 元数据泄露(3%)
```

## 期望效果

1. **突出核心安全差异**：重点关注协议间最大的安全差异点
2. **Safety导向**：高权重集中在直接影响安全的项目
3. **协议区分度最大化**：让真正有差异的项目发挥更大影响
4. **技术创新体现**：E2E检测等创新技术获得应有权重
